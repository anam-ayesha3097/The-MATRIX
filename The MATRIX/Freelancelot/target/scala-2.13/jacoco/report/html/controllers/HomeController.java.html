<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HomeController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">controllers</a> &gt; <span class="el_source">HomeController.java</span></div><h1>HomeController.java</h1><pre class="source lang-java linenums">package controllers;

import actors.*;
import akka.actor.ActorRef;
import akka.actor.ActorSystem;
import akka.stream.Materializer;
import akka.stream.javadsl.*;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.google.inject.Inject;
import models.*;
import play.mvc.*;
import scala.compat.java8.FutureConverters;
import service.FreelaancelotList;
import views.html.free;
import java.time.Duration;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;
import java.util.concurrent.ExecutionException;
import static akka.pattern.Patterns.ask;


/**
 * This is the Main controller contains an action to handle HTTP requests
 * to the application's home page.
 * @author Sankeerth Koduri Anam Ayesha Shaikh Raahul John Vikyath
 * @version 2.0
 */

/**
 * This controller contains an action to handle HTTP requests
 * to the application's home page.
 */
public class HomeController extends Controller {

    /**
     * An action that renders an HTML page with a welcome message.
     * The configuration in the &lt;code&gt;routes&lt;/code&gt; file means that
     * this method will be called when the application receives a
     * &lt;code&gt;GET&lt;/code&gt; request with a path of &lt;code&gt;/&lt;/code&gt;.
     */

    @Inject
    private ActorSystem actorSystem;
    @Inject
    private Materializer materializer;

    final ActorRef supervisorActor;
<span class="fc" id="L51">    LinkedHashMap&lt;String, FreelaancelotList&gt; response = new LinkedHashMap&lt;&gt;();</span>
    LinkedHashMap&lt;String, LinkedHashMap&lt;String, FreelaancelotList&gt;&gt; cache;
<span class="fc" id="L53">    HashMap&lt;Http.Session,String&gt; sessionRecord = null;</span>
    LinkedHashMap&lt;String, FreelaancelotList&gt; sessionResponse;
    String sessionKey;
    LinkedHashMap&lt;String, FreelaancelotList&gt; sessionData;
<span class="fc" id="L57">    Utilities ut = new Utilities();</span>
    LinkedHashMap&lt;String, FreelaancelotList&gt; firstTenProjects;
    LinkedHashMap&lt;String, FreelaancelotList&gt; firstTenProjectsFlesch;
    private ActorRef wordStatsActor;
    private ActorRef ownerProfile;
    private ActorRef skillsActor;
    private ActorRef fleschReadabilityActor;
<span class="fc" id="L64">    LinkedHashMap&lt;String, FreelaancelotList&gt; responsePro = new LinkedHashMap&lt;&gt;();</span>

    /**
     * Home Controller Constructor
     * @author Sankeerth Koduri Anam Ayesha Shaikh Raahul John Vikyath
     * @param actorSystem Actor System materializer Materializer
     * @version 2.0
     */
    @Inject
<span class="fc" id="L73">    public HomeController(ActorSystem actorSystem, Materializer materializer){</span>
<span class="fc" id="L74">    this.actorSystem = actorSystem;</span>
<span class="fc" id="L75">    this.materializer = materializer;</span>

        //System.out.println(&quot;Supervisor Actor created&quot;);
<span class="fc" id="L78">        supervisorActor = actorSystem.actorOf(SupervisorActor.getProps(), &quot;supervisingActor&quot;);</span>
<span class="fc" id="L79">        this.wordStatsActor = actorSystem.actorOf(actors.wordStatsActor.getProps());</span>
<span class="fc" id="L80">        this.fleschReadabilityActor = actorSystem.actorOf(FleschReadabilityIndexActor.getProps());</span>
<span class="fc" id="L81">        this.ownerProfile = actorSystem.actorOf(actors.ownerDetailsActor.getProps());</span>
<span class="fc" id="L82">        this.skillsActor = actorSystem.actorOf(actors.skillActor.getProps());</span>
        //this.freelancerActor = actorSystem.actorOf(Freelancer.getProps());

<span class="fc" id="L85">        cache = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L86">        sessionRecord = new HashMap&lt;&gt;();</span>
<span class="fc" id="L87">        sessionData = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L88">        firstTenProjects = new LinkedHashMap&lt;&gt;();</span>

<span class="fc" id="L90">    }</span>
    /**
     * Main Freelancelot Method
     * @author Sankeerth Koduri Anam Ayesha Shaikh Raahul John Vikyath
     * @param request Http Request and Search Term
     * @version 2.0
     */
    public  CompletionStage&lt;Result&gt; freelancelot(Http.Request request, String searchTerm) {
<span class="fc bfc" id="L98" title="All 2 branches covered.">        if(searchTerm.isEmpty()) {</span>
<span class="fc" id="L99">            CompletionStage&lt;Result&gt; response = CompletableFuture.supplyAsync(() -&gt; ok(views.html.freelancerInit.render()));</span>
<span class="fc" id="L100">            return  response;</span>
        }
        else {
            //System.out.println(&quot;Current Session&quot; +request.session());
<span class="fc" id="L104">            sessionRecord.put(request.session(),searchTerm);</span>
<span class="fc" id="L105">            return FutureConverters.toJava(ask(supervisorActor,</span>
                   new FreelancelotActor.callFreelancelotAPI(searchTerm), 6000))
<span class="fc" id="L107">                    .thenApplyAsync(responseProjects -&gt; {</span>
                        //System.out.println(&quot;Response Projects &quot;+responseProjects);
                        if(!((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects).isEmpty()){
                           cache.put(searchTerm, ((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects) );
                           responsePro = ((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects);
                            //System.out.println(&quot;Response Projects &quot;+responseProjects);
                        }

                        firstTenProjects = ut.first10projects((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects);
                        try {
                            //System.out.println(&quot;Inside Freelance Logic&quot;);
                            firstTenProjectsFlesch = fleschReadability(firstTenProjects).get();
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        } catch (ExecutionException e) {
                            e.printStackTrace();
                        }
                        return ok(free.render(request, searchTerm, firstTenProjectsFlesch));
<span class="fc" id="L125">                    }).toCompletableFuture();</span>
            //CompletionStage&lt;Result&gt; response = CompletableFuture.supplyAsync(() -&gt; ok(views.html.freelancerInit.render()));
            //return  response;
        }

    }

    public Result sayHello(String name){
<span class="nc" id="L133">        return  ok(&quot;&lt;h1&gt; Hi &quot;+name +&quot;&lt;/h1&gt;&quot;).as(&quot;text/html&quot;);</span>
    }

    /**
     * WebSocket Method
     * @author Sankeerth Koduri Anam Ayesha Shaikh Raahul John
     * @param searchTerm Search Term to get the projects from teh API
     * @version 2.0
     */
    public WebSocket ws(String searchTerm) {
<span class="nc" id="L143">        System.out.println(&quot;Inside Web Socket&quot;);</span>
<span class="nc" id="L144">        return WebSocket.Text.accept(request -&gt; {</span>
            // Log events to the console
            Sink&lt;String, ?&gt; freelanceRequest = Sink.foreach(System.out::println);
            ObjectMapper o = new ObjectMapper();
            Source&lt;String, ?&gt; wsFreelanceResponse = null;
            wsFreelanceResponse = Source.tick(Duration.ofSeconds(6), Duration.ofSeconds(6),
                                    FutureConverters.toJava(ask(supervisorActor,
                                    new FreelancelotActor.callFreelancelotAPI(searchTerm),
                                    6000))
                            .thenApplyAsync(responseProjects -&gt; {
                                if(!((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects).isEmpty()){
                                    cache.put(searchTerm, ((LinkedHashMap&lt;String, FreelaancelotList&gt;)responseProjects));
                                }
                                System.out.println(&quot;Web Sockets Response Project &quot;+responseProjects);

                                firstTenProjects = ut.first10projects((LinkedHashMap&lt;String, FreelaancelotList&gt;) responseProjects);
                                try {
                                    //System.out.println(&quot;Inside Freelance Logic&quot;);
                                    firstTenProjectsFlesch = fleschReadability(firstTenProjects).get();
                                } catch (InterruptedException e) {
                                    e.printStackTrace();
                                } catch (ExecutionException e) {
                                    e.printStackTrace();
                                }
                                return firstTenProjectsFlesch;
                            })
                            .thenApply(resString -&gt; {try {return o.writeValueAsString(resString);}
                            catch (JsonProcessingException e) {e.printStackTrace();}
                                return &quot;&quot;;
                            }).toCompletableFuture()).map(CompletableFuture::get);
            return Flow.fromSinkAndSource(freelanceRequest, wsFreelanceResponse);
        });
    }

    /**
     * Initialise Method of the Freelancelot Page
     * @author Sankeerth Koduri Anam Ayesha Shaikh Raahul John Vikyath
     * @version 2.0
     */
    public CompletionStage&lt;Result&gt; freelancelotInit() {
<span class="nc" id="L184">        CompletionStage&lt;Result&gt; response = CompletableFuture.supplyAsync(() -&gt; ok(views.html.freelancerInit.render()));</span>
<span class="nc" id="L185">        return  response;</span>
    }

    /**
     * Generates the Response in Reverse Order Actor
     * @param ownerId Owner ID
     * @return Displays Owner Information
     * @author Vikyath
     */
    public CompletionStage&lt;Result&gt; ownerInformation(String ownerId)
    {
<span class="fc" id="L196">        return FutureConverters.toJava(ask(ownerProfile, ownerId, Integer.MAX_VALUE))</span>
<span class="fc" id="L197">                .thenApply(response -&gt; {</span>
                    OwnerInformation resultmap = null;
                    try{
                        resultmap = (OwnerInformation) response;
                    }catch(Exception e){
                        return ok(&quot;Internal Server Error&quot;);
                    }
                    return ok(views.html.ownerDetails.render(resultmap));
                });
        //return ok(views.html.ownerDetails.render(ownerDetails.getOwnerDetails(ownerId)));
    }

    /**
     * Calculates the Individual Word Statistics Actor
     * @param search Search Term Job Searched
     * @return Renders the Word Stats Page
     * @author Sankeerth Koduri
     */
    public CompletionStage&lt;Result&gt; projectWordStats(String search)
    {
<span class="fc" id="L217">        return FutureConverters.toJava(ask(wordStatsActor, search, Integer.MAX_VALUE))</span>
<span class="fc" id="L218">                .thenApply(response -&gt; {</span>
                    LinkedHashMap&lt;String, Integer&gt; indvresultmap = null;
                    try{
                        indvresultmap = (LinkedHashMap&lt;String, Integer&gt;) response;
                    }catch(Exception e){
                        return ok(&quot;Internal Server Error&quot;);
                    }
                    return ok(views.html.projectwordstats.render(indvresultmap));
                });
    }

    /**
     * Displays the top 10 related skills of the job seacrhed Actor
     * @param s String which takes the job searched term
     * @return Renders the skills HTML page
     * @author Raahul John
     */
    public CompletionStage&lt;Result&gt; skills(String s) {
<span class="fc" id="L236">        return FutureConverters.toJava(ask(skillsActor, s, Integer.MAX_VALUE))</span>
<span class="fc" id="L237">                .thenApply(response -&gt; {</span>
                    LinkedHashMap&lt;String, FreelaancelotList&gt; resultmap = null;
                    try{
                        resultmap = (LinkedHashMap&lt;String, FreelaancelotList&gt;) response;
                    }catch(Exception e){
                        return ok(&quot;Internal Server Error&quot;);
                    }
                    return ok(views.html.skills.render(resultmap));
                });
    }

    /**
     * Displays the top Flesch Readability of the Projects both Global and Individual Actor
     * @param projects Projects from the API to add the Flesch Readability Value
     * @return CompletableFuture&lt;LinkedHashMap&lt;String,FreelaancelotList&gt;&gt; Returns the Completable Future of FreelaancelotList
     * @author Anam Ayesha Shaikh
     */
    public CompletableFuture&lt;LinkedHashMap&lt;String, FreelaancelotList&gt;&gt; fleschReadability(LinkedHashMap&lt;String, FreelaancelotList&gt; projects){
        //System.out.println(&quot;Inside Flesch Readability&quot;);
<span class="fc" id="L256">        return FutureConverters.toJava(ask(fleschReadabilityActor, new FleschReadabilityIndexActor.callFleschReadability(projects), Integer.MAX_VALUE))</span>
<span class="fc" id="L257">                .thenApplyAsync(responsePro -&gt; {</span>
                    LinkedHashMap&lt;String, FreelaancelotList&gt; resultmap = null;
                    resultmap = ((LinkedHashMap&lt;String, FreelaancelotList&gt;)responsePro);
                    //System.out.println(&quot;Result Map&quot;);
                    return resultmap;
                   })
<span class="fc" id="L263">                .toCompletableFuture();</span>
    }

    /**
     * Calculates the Global Word Statistics
     * @param search Search Term Job Searched
     * @return Renders the Word Statistics Page
     * @author Sankeerth Koduri
     */
    public CompletionStage&lt;Result&gt; wordStats(String search)
    {
        //System.out.println(&quot;Inside Global Word Stats&quot;);
<span class="nc" id="L275">        return FutureConverters.toJava(ask(wordStatsActor, responsePro.get(search), Integer.MAX_VALUE))</span>
<span class="nc" id="L276">                .thenApply(response -&gt; {</span>
                    LinkedHashMap&lt;String, Integer&gt; resultmap = null;
                    try{
                        resultmap = (LinkedHashMap&lt;String, Integer&gt;) response;
                    }catch(Exception e){
                        return ok(&quot;Internal Server Error&quot;);
                    }
                    return ok(views.html.wordstats.render(resultmap));
                });
        //return ok(views.html.wordstats.render(ws.GlobalStats(response.get(search))));
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>